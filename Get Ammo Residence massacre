--// 🔫 SCRIPT GET AMMO FIXADO E OTIMIZADO
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

-- ===== WHITELIST =====
local WHITELIST = {
    "lindao_gojo3","tuqtc374","pancha_gamer1234","jdnekddo2","Dz7_Exit",
    "ERrOr999898","NguyenphongZfypK","Survivor_0149","Scott3394","kaiser_12lh",
    "vovosiox","tupoke_827","ninjala2207","DAVI_BR580","kekeidieis",
    "RIP_SADBOY4864","Entility_dandyworld","narutokunzo","Kratze_katze",
    "Dereckcolina1","TheManFolther","MUSHAKI3","bbEmanuel111","KKG0Z038","kiwi32608",
    "FortniteGuy917","shichan747","naruto_uzumaki37373","iamnot_tapwater0","LOOKATTHIS_NOPE",
    "hehehehpro27","dTruly_Herob","FiqhtForHonor","ken_kaneki100152","Zorromieldog","Xando0801",
    "santhibustillo","fernah_8","Faltreh","lubomir490","fenkeqe","jtx_181818","thirdbacruya12345",
    "chinichi201436","DIABL0421","GodGardenGod1","PeanutsSlayer45",eduardogamerjj0","nandojoao32"
}
local DISCORD_LINK = "https://discord.gg/X2k52XZwjX"

-- ===== POSIÇÕES DE TELEPORTE =====
local teleportPositions = {
    Vector3.new(-45,4,-66),
    Vector3.new(52,4,283),
    Vector3.new(95,4,179),
    Vector3.new(-7,4,-150)
}

local REMOTE_LOOP_DURATION = 5
local TELEPORT_INTERVAL = 0.1
local FIRE_LOOP_STEP = 0.0

-- ===== MENSAGEM CENTRAL =====
local function showCenterMessage(text, duration)
    duration = duration or 3
    local screen = Instance.new("ScreenGui")
    screen.Name = "CenterMessage"
    screen.ResetOnSpawn = false
    screen.IgnoreGuiInset = true
    screen.Parent = player:WaitForChild("PlayerGui")

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0.4,0,0.1,0)
    frame.Position = UDim2.new(0.5,0,0.5,0)
    frame.AnchorPoint = Vector2.new(0.5,0.5)
    frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
    frame.BackgroundTransparency = 0.35
    frame.Parent = screen

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1,0,1,0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.new(1,1,1)
    label.Font = Enum.Font.SourceSansBold
    label.TextScaled = true
    label.Parent = frame

    task.delay(duration, function()
        if screen then screen:Destroy() end
    end)
end

-- ===== AUTORIZAÇÃO =====
local authorized = false
for _, name in ipairs(WHITELIST) do
    if player.Name == name then
        authorized = true
        break
    end
end

if not authorized then
    pcall(function() setclipboard(DISCORD_LINK) end)
    showCenterMessage("authorization denied, visit our discord server to go to whitelist",5)
    return
else
    showCenterMessage("authorization confirmed :3",3)
end

-- ===== ESPERAR PERSONAGEM =====
local function waitChar()
    local ch = player.Character or player.CharacterAdded:Wait()
    local root = ch:WaitForChild("HumanoidRootPart",5)
    return ch, root
end

-- ===== GUI =====
local function createGUI()
    local gui = Instance.new("ScreenGui")
    gui.Name = "GetAmmoGUI"
    gui.IgnoreGuiInset = false
    gui.ResetOnSpawn = false
    gui.Parent = player:WaitForChild("PlayerGui")

    local button = Instance.new("TextButton")
    button.Name = "GetAmmoButton"
    button.Size = UDim2.new(0,140,0,45)
    button.Position = UDim2.new(1,-160,0,30)
    button.AnchorPoint = Vector2.new(1,0)
    button.BackgroundColor3 = Color3.fromRGB(60,180,75)
    button.TextColor3 = Color3.new(1,1,1)
    button.Font = Enum.Font.GothamBold
    button.TextSize = 20
    button.Text = "Get Ammo"
    button.Active = true
    button.AutoButtonColor = true
    button.Parent = gui

    return gui, button
end

-- ===== FIRE CLICK DETECTOR =====
local availableFire = nil
local function detectFireFunctions()
    local candidates = {"fireclickdetector","clickdetectorfire","fireClickDetector","FireClickDetector"}
    for _, name in ipairs(candidates) do
        if type(_G[name]) == "function" then
            return _G[name]
        end
    end
    if type(fireclickdetector) == "function" then return fireclickdetector end
    return nil
end
availableFire = detectFireFunctions()

local function tryFireDetector(detector)
    if not detector or not detector:IsA("ClickDetector") then return false end
    if availableFire then
        local ok = pcall(function() availableFire(detector) end)
        if ok then return true end
    end
    local ok, gc = pcall(function() return getconnections end)
    if ok and typeof(gc) == "function" then
        local conns = pcall(function() return getconnections(detector.MouseClick) end)
        if typeof(conns) == "table" then
            for _, c in ipairs(conns) do
                pcall(function()
                    if typeof(c.Function) == "function" then c.Function(player) end
                end)
            end
        end
    end
    return false
end

-- ===== CLICK DETECTORS =====
local function collectDetectors()
    local a = workspace:FindFirstChild("AmmoPiles")
    if not a then return {} end
    local detectors = {}
    for _, obj in ipairs(a:GetDescendants()) do
        if obj:IsA("ClickDetector") then
            table.insert(detectors, obj)
        end
    end
    return detectors
end

-- ===== FIRE LOOP =====
local function fireAllFor(detectors, duration)
    local t0 = tick()
    while tick() - t0 < duration do
        for _, d in ipairs(detectors) do
            pcall(function() tryFireDetector(d) end)
        end
        task.wait(FIRE_LOOP_STEP)
    end
end

-- ===== CRIAÇÃO DE GUI =====
local gui, button = createGUI()

-- ===== BOTÃO =====
button.MouseButton1Click:Connect(function()
    button.Active = false
    local ch, root = waitChar()
    local original = root.CFrame
    local detectors = collectDetectors()

    if #detectors == 0 then
        button.Active = true
        return
    end

    for _, pos in ipairs(teleportPositions) do
        pcall(function() root.CFrame = CFrame.new(pos + Vector3.new(0,3,0)) end)
        task.spawn(function() fireAllFor(detectors, REMOTE_LOOP_DURATION) end)
        task.wait(TELEPORT_INTERVAL)
    end

    task.wait(0.2)
    pcall(function() root.CFrame = original end)
    button.Active = true
end)

-- ===== RECRIAR BOTÃO SE SUMIR =====
task.spawn(function()
    while true do
        task.wait(3)
        if not gui or not gui.Parent or not button or not button.Parent then
            gui, button = createGUI()
        end
    end
end)

-- ===== HIGHLIGHTS =====
local function createHighlight(parent, color)
    if not parent then return end
    local hl = Instance.new("Highlight")
    hl.FillColor = color
    hl.OutlineColor = color
    hl.Adornee = parent
    hl.Parent = player:WaitForChild("PlayerGui")
    return hl
end

local mutant = ReplicatedStorage:WaitForChild("Mutant")
local workerHead = ReplicatedStorage:WaitForChild("WorkerHead")
local zombiesFolder = workspace:WaitForChild("Zombies")

local mutantHL = createHighlight(mutant, Color3.fromRGB(255,0,0))
local workerHL = createHighlight(workerHead, Color3.fromRGB(255,0,0))
local zombiesHighlights = {}

local function updateZombiesHighlights()
    for _, hl in pairs(zombiesHighlights) do
        if hl and hl.Parent then hl:Destroy() end
    end
    zombiesHighlights = {}
    for _, obj in ipairs(zombiesFolder:GetChildren()) do
        if obj:IsA("Model") or obj:IsA("Part") then
            local hl = createHighlight(obj, Color3.fromRGB(255,255,0))
            zombiesHighlights[obj] = hl
        end
    end
end

task.spawn(function()
    while true do
        task.wait(0.5)
        if mutantHL then mutantHL.Adornee = mutant end
        if workerHL then workerHL.Adornee = workerHead end
        updateZombiesHighlights()
    end
end)
